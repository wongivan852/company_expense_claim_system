{% extends 'base.html' %}
{% load static %}

{% block title %}Business Platform - Krystal Group{% endblock %}

{% block extra_css %}
<style>
    body {
        background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        min-height: 100vh;
    }

    .welcome-banner {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border-radius: 20px;
        padding: 3rem 2rem;
        color: white;
        margin-bottom: 2rem;
        box-shadow: 0 10px 40px rgba(102, 126, 234, 0.3);
        position: relative;
        overflow: hidden;
    }

    .welcome-banner::before {
        content: '';
        position: absolute;
        top: -50%;
        right: -10%;
        width: 300px;
        height: 300px;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 50%;
    }

    .welcome-content {
        position: relative;
        z-index: 2;
    }

    .app-card {
        background: white;
        border-radius: 15px;
        padding: 2rem;
        height: 100%;
        border: none;
        box-shadow: 0 5px 20px rgba(0,0,0,0.08);
        transition: all 0.3s ease;
        cursor: pointer;
        text-decoration: none;
        color: inherit;
        display: block;
    }

    .app-card:hover {
        transform: translateY(-10px);
        box-shadow: 0 15px 40px rgba(0,0,0,0.15);
        text-decoration: none;
        color: inherit;
    }

    .app-icon {
        width: 70px;
        height: 70px;
        border-radius: 15px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 2rem;
        margin-bottom: 1.5rem;
        transition: all 0.3s ease;
    }

    .app-card:hover .app-icon {
        transform: scale(1.1) rotate(5deg);
    }

    .app-card.primary .app-icon {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
    }

    .app-card.info .app-icon {
        background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        color: white;
    }

    .app-card.success .app-icon {
        background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
        color: white;
    }

    .app-card.warning .app-icon {
        background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        color: white;
    }

    .app-card h4 {
        font-weight: 700;
        margin-bottom: 0.75rem;
        color: #2d3748;
    }

    .app-card p {
        color: #718096;
        margin-bottom: 0;
        font-size: 0.95rem;
    }

    .stat-badge {
        background: white;
        border-radius: 12px;
        padding: 1.5rem;
        text-align: center;
        box-shadow: 0 5px 15px rgba(0,0,0,0.08);
    }

    .stat-badge h3 {
        font-size: 2rem;
        font-weight: 700;
        margin-bottom: 0.5rem;
        color: #2d3748;
    }

    .stat-badge p {
        color: #718096;
        margin-bottom: 0;
        font-size: 0.9rem;
    }

    .section-title {
        font-weight: 700;
        color: #2d3748;
        margin-bottom: 1.5rem;
        display: flex;
        align-items: center;
    }

    .section-title i {
        margin-right: 0.75rem;
        color: #667eea;
    }

    .unauthenticated-container {
        min-height: 80vh;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .welcome-card {
        background: white;
        border-radius: 20px;
        padding: 3rem;
        box-shadow: 0 20px 60px rgba(0,0,0,0.1);
        text-align: center;
        max-width: 600px;
    }

    .feature-icon {
        width: 80px;
        height: 80px;
        border-radius: 50%;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        font-size: 2rem;
        margin-bottom: 1rem;
    }

    @media (max-width: 768px) {
        .welcome-banner {
            padding: 2rem 1rem;
        }

        .app-card {
            margin-bottom: 1rem;
        }
    }
</style>
{% endblock %}

{% block content %}
{% if user.is_authenticated %}
<!-- Welcome Banner -->
<div class="welcome-banner">
    <div class="welcome-content">
        <div class="row align-items-center">
            <div class="col-md-8">
                <h1 class="display-5 mb-3">
                    <i class="fas fa-building me-3"></i>
                    Welcome back, {{ user.first_name|default:user.username }}!
                </h1>
                <p class="lead mb-2">
                    <i class="fas fa-briefcase me-2"></i>
                    {{ user.position|default:"Staff Member" }} â€¢ {{ user.department|default:"General" }}
                </p>
                <p class="mb-0">
                    <i class="fas fa-calendar-alt me-2"></i>
                    {% now "l, F j, Y" %}
                </p>
            </div>
            <div class="col-md-4 text-end d-none d-md-block">
                <i class="fas fa-th-large fa-5x opacity-25"></i>
            </div>
        </div>
    </div>
</div>

<!-- Quick Stats -->
<div class="row mb-4">
    <div class="col-md-3 mb-3">
        <div class="stat-badge">
            <i class="fas fa-file-invoice-dollar text-primary fa-2x mb-2"></i>
            <h3 class="text-primary">{{ user_stats.total_claims|default:0 }}</h3>
            <p>Total Claims</p>
        </div>
    </div>
    <div class="col-md-3 mb-3">
        <div class="stat-badge">
            <i class="fas fa-check-circle text-success fa-2x mb-2"></i>
            <h3 class="text-success">{{ user_stats.approved_claims|default:0 }}</h3>
            <p>Approved</p>
        </div>
    </div>
    <div class="col-md-3 mb-3">
        <div class="stat-badge">
            <i class="fas fa-clock text-warning fa-2x mb-2"></i>
            <h3 class="text-warning">{{ user_stats.pending_claims|default:0 }}</h3>
            <p>Pending</p>
        </div>
    </div>
    <div class="col-md-3 mb-3">
        <div class="stat-badge">
            <i class="fas fa-dollar-sign text-info fa-2x mb-2"></i>
            <h3 class="text-info">${{ user_stats.total_amount|default:0|floatformat:2 }}</h3>
            <p>Total Amount</p>
        </div>
    </div>
</div>

<!-- Platform Applications -->
<h2 class="section-title">
    <i class="fas fa-th"></i>
    Available Applications
</h2>

<div class="row mb-4">
    {% for app in platform_apps %}
    <div class="col-md-6 col-lg-3 mb-4">
        <a href="{% url app.url %}" class="app-card {{ app.color }}">
            <div class="app-icon">
                <i class="fas {{ app.icon }}"></i>
            </div>
            <h4>{{ app.name }}</h4>
            <p>{{ app.description }}</p>
            {% if not app.available %}
            <span class="badge bg-secondary mt-2">Coming Soon</span>
            {% endif %}
        </a>
    </div>
    {% endfor %}
</div>

<!-- Recent Activity -->
{% if recent_claims %}
<h2 class="section-title mt-5">
    <i class="fas fa-history"></i>
    Recent Activity
</h2>

<div class="card" style="border-radius: 15px; border: none; box-shadow: 0 5px 20px rgba(0,0,0,0.08);">
    <div class="card-body p-4">
        <div class="table-responsive">
            <table class="table table-hover mb-0">
                <thead>
                    <tr>
                        <th>Claim #</th>
                        <th>Event</th>
                        <th>Amount</th>
                        <th>Status</th>
                        <th>Date</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody>
                    {% for claim in recent_claims %}
                    <tr>
                        <td><strong>{{ claim.claim_number }}</strong></td>
                        <td>{{ claim.event_name|truncatechars:40 }}</td>
                        <td>${{ claim.total_amount|floatformat:2 }}</td>
                        <td>
                            {% if claim.status == 'approved' %}
                                <span class="badge bg-success">Approved</span>
                            {% elif claim.status == 'pending' %}
                                <span class="badge bg-warning">Pending</span>
                            {% elif claim.status == 'rejected' %}
                                <span class="badge bg-danger">Rejected</span>
                            {% else %}
                                <span class="badge bg-secondary">{{ claim.status|title }}</span>
                            {% endif %}
                        </td>
                        <td>{{ claim.created_at|date:"M d, Y" }}</td>
                        <td>
                            <a href="{% url 'expense_claims:claim_detail' claim.pk %}" class="btn btn-sm btn-outline-primary">
                                <i class="fas fa-eye"></i>
                            </a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endif %}

{% else %}
<!-- Unauthenticated View -->
<div class="unauthenticated-container">
    <div class="welcome-card">
        <div class="mb-4">
            <div class="feature-icon bg-primary text-white mx-auto">
                <i class="fas fa-building"></i>
            </div>
            <h1 class="display-5 mb-3">Krystal Group</h1>
            <h3 class="text-muted mb-4">Integrated Business Platform</h3>
            <p class="lead text-muted mb-4">
                Your unified platform for business management, expense tracking, document management, and reporting.
            </p>
        </div>

        <div class="row text-center mb-4">
            <div class="col-md-4 mb-3">
                <div class="feature-icon bg-primary text-white mx-auto" style="width: 60px; height: 60px; font-size: 1.5rem;">
                    <i class="fas fa-file-invoice-dollar"></i>
                </div>
                <h6 class="mt-2">Expense Management</h6>
            </div>
            <div class="col-md-4 mb-3">
                <div class="feature-icon bg-info text-white mx-auto" style="width: 60px; height: 60px; font-size: 1.5rem;">
                    <i class="fas fa-folder-open"></i>
                </div>
                <h6 class="mt-2">Document Hub</h6>
            </div>
            <div class="col-md-4 mb-3">
                <div class="feature-icon bg-success text-white mx-auto" style="width: 60px; height: 60px; font-size: 1.5rem;">
                    <i class="fas fa-chart-line"></i>
                </div>
                <h6 class="mt-2">Analytics</h6>
            </div>
        </div>

        <div class="d-grid gap-2 d-md-flex justify-content-md-center">
            <a href="{% url 'accounts:login' %}" class="btn btn-primary btn-lg px-5">
                <i class="fas fa-sign-in-alt me-2"></i>Login
            </a>
            <a href="{% url 'admin:index' %}" class="btn btn-outline-secondary btn-lg px-5">
                <i class="fas fa-cog me-2"></i>Admin Panel
            </a>
        </div>

        <div class="mt-4 pt-3 border-top">
            <p class="text-muted small mb-0">
                <i class="fas fa-info-circle me-2"></i>
                Please contact your system administrator if you need access
            </p>
        </div>
    </div>
</div>
{% endif %}
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Animate app cards on load
    const appCards = document.querySelectorAll('.app-card');
    appCards.forEach((card, index) => {
        card.style.opacity = '0';
        card.style.transform = 'translateY(20px)';

        setTimeout(() => {
            card.style.transition = 'all 0.6s ease';
            card.style.opacity = '1';
            card.style.transform = 'translateY(0)';
        }, index * 100);
    });

    // Animate stat badges
    const statBadges = document.querySelectorAll('.stat-badge');
    statBadges.forEach((badge, index) => {
        badge.style.opacity = '0';
        badge.style.transform = 'scale(0.8)';

        setTimeout(() => {
            badge.style.transition = 'all 0.5s ease';
            badge.style.opacity = '1';
            badge.style.transform = 'scale(1)';
        }, index * 100);
    });
});
</script>
{% endblock %}
